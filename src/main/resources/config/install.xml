<?xml version="1.0" encoding="UTF-8"?>
<project>
	<variable name="PRODUCT_NAME" value="nontax" />
	<variable name="VERSION_NUMBER" value="3.0" />
	<variable name="EDITION" value="PE" />
	<variable name="RUNNER_TYPE" value="install" />
	<!-- 安装此产品需要的空间，以MB为单位 -->
	<variable name="DISK_NEEDED" value="1024" />
	<loadproperties srcfile="productinfo.properties" />
	<renderer classname="com.bosssoft.platform.installer.wizard.gui.StepListRenderer" />

	<steps firststep="01">
		<step id="01" desc="Install Initialize">
			<echo message="start install bosssoft gateway PE............" />
			<if>
				<equals arg1="${IS_SILENT_INSTALL}" arg2="true" />
				<then>
					<action name="silent installing init"
						classname="com.bosssoft.platform.installer.wizard.action.SilentInit" />
				</then>
			</if>
			<action name="init install"
				classname="com.bosssoft.platform.installer.wizard.action.InstallerInitialize"
				desc="Installer Initialize..." />
			<echo message="INSTALL_ROOT ............${INSTALL_ROOT}" />
			<action name="get temp dir" classname="com.bosssoft.platform.installer.wizard.action.GetTempDir"
				desc="get temprary dir">
				<parameter name="variable_key" value="TEMP_DIR" />
			</action>
			<echo message="tempdir == ${TEMP_DIR}" />
			<nextstep default="011" />
		</step>
		<step id="011" desc="Temp Space Check">
			<action name="check temp space" classname="com.bosssoft.platform.installer.wizard.action.CheckDiskSpace"
				desc="Disk space is enough">
				<parameter name="DIR" value="${TEMP_DIR}" />
				<parameter name="SPACESIZE" value="200" />
				<parameter name="VARIABLE_INDEX" value="TEMPSPACE_ENOUGH" />
			</action>
			<nextstep discriminator="${TEMPSPACE_ENOUGH}">
				<branch id="true" stepid="02" />
				<branch id="false" stepid="012" />
			</nextstep>
		</step>
		<step id="012" desc="TempSpaceChoose">
			<gui setuppanel="com.bosssoft.platform.installer.wizard.gui.TempSpaceChoosePanel"
				controlpanel="com.bosssoft.platform.installer.wizard.gui.ConfirmCancelControlPanel"
				render="false" />
			<nextstep default="011" />
		</step>
		<step id="02" desc="Choose">
			<gui setuppanel="com.bosssoft.install.windows.patch.gui.ChoosePanel" />
		    <if>
				<equals arg1="${IS_SILENT_INSTALL}" arg2="true" />
				<then>
					<action name="silent choose"
						classname="com.bosssoft.install.windows.patch.action.SilentChoose" />
				</then>
		    </if>
		   	<nextstep default="03" />
		</step>
		
		<step id="03" desc="Setbosssofthome" 
			  interceptor="com.bosssoft.install.windows.patch.event.SetBossHomeInterceptor">
			<gui setuppanel="com.bosssoft.platform.installer.wizard.gui.BossHomeChoosePanel" />
		   <nextstep discriminator="${IS_UPDATE}">
				<branch id="true" stepid="04" />
				<branch id="false" stepid="041" />
			</nextstep>
		</step>
		<step id="04" desc="Installing" auto="true">
			<gui setuppanel="com.bosssoft.platform.installer.wizard.gui.InstallingPanel" />
			<actionscall id="install" />
			<nextstep default="05" />
		</step>
		
		<step id="041" desc="rollback" auto="true">
			<gui setuppanel="com.bosssoft.platform.installer.wizard.gui.InstallingPanel" />
		    <actionscall id="rollback" />
			<nextstep default="051" />
		</step>
		
		<step id="05" desc="Finished">
			 <!--<gui setuppanel="com.bosssoft.install.windows.patch.gui.PatchFinishedPanel" /> -->
		  <gui setuppanel="com.bosssoft.install.windows.patch.gui.UpdateFinishedPanel" />
		</step>
		
		<step id="051" desc="Finished">
			 <!--<gui setuppanel="com.bosssoft.install.windows.patch.gui.PatchFinishedPanel" /> -->
		  <gui setuppanel="com.bosssoft.install.windows.patch.gui.RollbackFinishedPanel" />
		</step>
		
	</steps>

	<actions id="install">
		<!--加载补丁配置文件-->
		<action name="init config" classname="com.bosssoft.install.windows.patch.action.LoadConfig" scale="50">
		</action>
		
		<!--更新检查-->
		<action name="check update" classname="com.bosssoft.install.windows.patch.action.CheckUpdate" scale="50">
		</action>
		<!--更新检查通过才允许更新-->
		<if>
			<equals arg1="${IS_CAN_UPDATE}" arg2="true" />
				<then>
					<!--备份-->
					<!--<action name="Backup Product"
						classname="com.bosssoft.install.windows.patch.action.BackupProduct" >
						<parameter name="EXTRA_FILES" value="${PRODUCT_INSTALL_DIR}/nginx-1.13.0/conf/nginx.conf,${PRODUCT_INSTALL_DIR}/uninstall.bat" />
						<parameter name="BACKUP_DIR"  value="D:/test/backup"/>
					</action>-->
					<!--更新应用-->
					<action name="Update Product"
						classname="com.bosssoft.install.windows.patch.action.UpdateProduct" />
			        <!--更新版本信息-->
			       <!--<action name="Update Version"
						classname="com.bosssoft.install.windows.patch.action.UpdateVersion" />-->
						
					<!--完善更新-->
					<!--<action name="Update Version"
						classname="com.bosssoft.install.windows.patch.action.FinishedPatch" />-->
			  </then>
		</if>
	</actions>
	
	
	<actions id="rollback">
	  <action name="init config" classname="com.bosssoft.install.windows.patch.action.RollBack">
		</action>
	</actions>
</project>